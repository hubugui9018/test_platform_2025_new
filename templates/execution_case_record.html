{% load static %}
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>执行记录</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container mt-4">
    <h1>测试用例执行记录</h1>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th>ID</th>
            <th>设备名称</th>
            <th>产品名称</th>
            <th>测试用例ID</th>
            <th>开始时间</th>
            <th>结束时间</th>
            <th>执行时间</th>
            <th>结果</th>
            <th>日志</th>
            <th>截图</th>
        </tr>
        </thead>
        <tbody>
        {% for record in result %}
            <tr>
                <td>{{ record.id }}</td>
                <td>{{ record.unique_id }}</td>
                <td>{{ record.product_name }}</td>
                <td>{{ record.test_case_id }}</td>
                <td>{{ record.start_time|date:"Y年m月d日 H时i分s秒" }}</td>
                <td>{{ record.end_time|date:"Y年m月d日 H时i分s秒" }}</td>
                <td>{{ record.execution_time }}</td>
                <td>{{ record.result }}</td>
                <td>{{ record.log }}</td>
                <td><a href="#" class="screenshot-link" data-path="{{ record.screenshot_path }}" data-bs-toggle="modal" data-bs-target="#screenshotModal">查看截图</a></td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="10" class="text-center">没有数据</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <!-- 分页控制 -->
    <div class="d-flex justify-content-between mt-4">
        {% if page_obj.has_previous %}
            <a href="?page_number={{ page_obj.previous_page_number }}" class="btn btn-secondary">上一页</a>
        {% else %}
            <button class="btn btn-secondary" disabled>上一页</button>
        {% endif %}

        {% if page_obj.has_next %}
            <a href="?page_number={{ page_obj.next_page_number }}" class="btn btn-secondary">下一页</a>
        {% else %}
            <button class="btn btn-secondary" disabled>下一页</button>
        {% endif %}
    </div>
</div>

<!-- 截图模态框 -->
<div class="modal fade" id="screenshotModal" tabindex="-1" aria-labelledby="screenshotModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="screenshotModalLabel">截图详情</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <img id="screenshotImage" src="" class="img-fluid" alt="截图">
            </div>
        </div>
    </div>
</div>


<script>
$(document).ready(function() {
    // 为每个链接动态设置截图路径
    $('.screenshot-link').on('click', function() {
        var relativePath = $(this).data('path');  // 获取记录的截图相对路径
        var fullPath = '/' + relativePath;  // 拼接成完整的路径
        $('#screenshotImage').attr('src', fullPath);  // 设置模态框中图片的 src
    });
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>